# 🖼️ راهنمای اسکرین گرفتن و پاسخ‌دهی هوشمند

## ویژگی جدید: اسکرین تلگرام + پاسخ

### 🎯 هدف
این ویژگی جدید فقط از پنجره تلگرام با مسیر مشخص شده در کانفیگ اسکرین‌شات می‌گیرد و سپس چت‌ها را دقیقاً شناسایی و به آنها پاسخ می‌دهد.

### 🔧 نحوه کار

#### مرحله ۱: شناسایی پنجره تلگرام
```python
# پیدا کردن پنجره تلگرام بر اساس مسیر کانفیگ
telegram_path = "C:\\Program Files\\WindowsApps\\TelegramMessengerLLP.TelegramDesktop_5.16.5.0_x64__t4vj0pshhgkwm\\Telegram.exe"
windows = gw.getWindowsWithTitle('Telegram')
```

#### مرحله ۲: گرفتن اسکرین‌شات
```python
# فعال‌سازی و اسکرین‌شات از پنجره
target_window.activate()
screenshot = pyautogui.screenshot(region=(left, top, width, height))
```

#### مرحله ۳: تشخیص چت‌ها
```python
# تشخیص چت‌های خوانده نشده (اولویت بالا)
unread_chats = detect_unread_chats_from_screenshot(img)

# تشخیص چت‌های عادی
chat_positions = detect_chats_from_screenshot(img)
```

#### مرحله ۴: پاسخ‌دهی هوشمند
```python
# تحلیل نیاز به پاسخ
needs_reply = analyze_need_for_reply(last_messages, chat_name)

# تولید و ارسال پاسخ
smart_reply = generate_contextual_reply(context)
smart_send_message(smart_reply)
```

## 🚀 نحوه استفاده

### ۱. راه‌اندازی
- اطمینان حاصل کنید تلگرام با مسیر مشخص شده در کانفیگ باز است
- دکمه **"🖼️ اسکرین تلگرام + پاسخ"** را کلیک کنید

### ۲. فرآیند خودکار
برنامه به ترتیب زیر عمل می‌کند:

1. **پیدا کردن پنجره تلگرام**
   - جستجو بر اساس عنوان "Telegram"
   - اگر پیدا نشد، سعی می‌کند تلگرام را باز کند

2. **گرفتن اسکرین‌شات**
   - فعال‌سازی پنجره تلگرام
   - گرفتن اسکرین‌شات از کل پنجره
   - ذخیره در فایل `telegram_screenshot.png`

3. **تشخیص چت‌های خوانده نشده**
   - جستجوی badge های آبی رنگ
   - اولویت‌بندی این چت‌ها برای پاسخ فوری

4. **بررسی چت‌های عادی**
   - تشخیص موقعیت سایر چت‌ها
   - تحلیل نیاز به پاسخ

5. **پاسخ‌دهی هوشمند**
   - خواندن پیام‌های اخیر
   - تولید پاسخ متناسب با محتوا
   - ارسال پاسخ به چت

## ⚙️ تنظیمات پیشرفته

### شناسایی چت‌های خوانده نشده
برنامه از الگوریتم تشخیص رنگ استفاده می‌کند:
```python
# رنگ آبی badge های خوانده نشده
blue_lower = np.array([100, 100, 100])  # HSV
blue_upper = np.array([130, 255, 255])
```

### تشخیص موقعیت چت‌ها
دو روش برای تشخیص:
1. **تشخیص خطوط جداکننده**: پیدا کردن مرزهای بین چت‌ها
2. **تقسیم‌بندی یکنواخت**: در صورت عدم موفقیت روش اول

### نواحی پنجره تلگرام
```python
# تنظیم خودکار نواحی بر اساس ابعاد پنجره
chat_list_region = (0, 80, width * 0.35, height - 160)
message_area_region = (width * 0.35, 80, width * 0.65, height - 160)
input_box_region = (width * 0.35, height - 80, width * 0.6, 40)
send_button_region = (width * 0.95 - 50, height - 80, 50, 40)
```

## 📊 گزارش‌دهی

### اطلاعات نمایش داده شده:
- ✅ **وضعیت پیدا کردن پنجره**: موفقیت یا عدم موفقیت
- 📏 **ابعاد پنجره**: عرض × ارتفاع و موقعیت
- 📬 **تعداد چت‌های خوانده نشده**: شمارش دقیق
- 🎯 **تعداد چت‌های شناسایی شده**: تعداد کل چت‌ها
- 💬 **نام چت‌های پردازش شده**: فهرست چت‌هایی که بررسی شدند
- 📖 **تعداد پیام‌های خوانده شده**: در هر چت
- ✅/❌ **وضعیت ارسال پاسخ**: موفقیت یا خطا

### نمونه خروجی لاگ:
```
🖼️ شروع اسکرین گرفتن از تلگرام: اکانت اصلی
✅ پنجره تلگرام پیدا شد: Telegram
📏 ابعاد پنجره: 1200x800 در موقعیت (100, 50)
✅ اسکرین‌شات از تلگرام ذخیره شد!
🔍 شروع تشخیص چت‌ها از اسکرین‌شات...
📬 3 چت خوانده نشده تشخیص داده شد
📨 کلیک روی چت خوانده نشده 1 در (275, 180)
💬 پردازش چت خوانده نشده: getharemmeow
📖 5 پیام خوانده شد
✅ پاسخ ارسال شد به getharemmeow: سلام دوستان! چطورید؟...
```

## 🔧 عیب‌یابی

### مشکلات رایج

#### پنجره تلگرام پیدا نمی‌شود
**علت**: تلگرام باز نیست یا عنوان پنجره متفاوت است
**راه‌حل**: 
- تلگرام را باز کنید
- از طریق دکمه "📱 باز کردن تلگرام" اقدام کنید

#### اسکرین‌شات خالی یا نادرست
**علت**: پنجره تلگرام minimize شده یا پشت پنجره‌های دیگر است
**راه‌حل**:
- تلگرام را به حالت عادی (restore) درآورید
- سایر پنجره‌ها را ببندید یا کوچک کنید

#### چت‌ها تشخیص داده نمی‌شوند
**علت**: تم تلگرام یا layout متفاوت از حالت استاندارد است
**راه‌حل**:
- تم پیش‌فرض تلگرام را استفاده کنید
- لیست چت‌ها را کاملاً باز کنید
- از zoom پیش‌فرض استفاده کنید

#### پاسخ‌ها ارسال نمی‌شوند
**علت**: باکس ورودی پیام تشخیص داده نمی‌شود
**راه‌حل**:
- چت مورد نظر را کاملاً باز کنید
- از سیستم fallback استفاده می‌شود

## 🎨 ویژگی‌های پیشرفته

### اولویت‌بندی پاسخ‌ها
1. **چت‌های خوانده نشده** (badge آبی)
2. **چت‌هایی که سوال پرسیده‌اند**
3. **پیام‌های فوری** (کلمات کلیدی مثل "فوری", "مهم")
4. **احوال‌پرسی‌ها** ("سلام", "چطورید")

### تحلیل محتوای پیام
```python
# نشانه‌های سوال
question_indicators = ['؟', '?', 'چی', 'چه', 'کی', 'کجا', 'چرا', 'چطور']

# کلمات فوری  
urgent_keywords = ['فوری', 'مهم', 'ضروری', 'سریع', 'urgent', 'important']

# احوال‌پرسی
greeting_keywords = ['سلام', 'hi', 'hello', 'صبح بخیر', 'ظهر بخیر']
```

## 📁 فایل‌های تولید شده

### telegram_screenshot.png
- اسکرین‌شات کامل از پنجره تلگرام
- برای debugging و بررسی دستی مفید است
- در هر اجرا بازنویسی می‌شود

---

**نکته مهم**: این ویژگی مخصوص پردازش دقیق پنجره تلگرام طراحی شده و بهترین عملکرد را در شرایط استاندارد ارائه می‌دهد.
