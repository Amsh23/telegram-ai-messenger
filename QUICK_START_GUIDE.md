# 🔧 راهنمای سریع: رفع مشکل تشخیص پنجره تلگرام

## ✅ **مشکلات رفع شده:**

### 1️⃣ **مشکل تشخیص پنجره اشتباه**
**قبل**: برنامه خود رابط Python را پیدا می‌کرد  
**حالا**: فیلتر هوشمند برای پیدا کردن پنجره تلگرام واقعی

```python
def find_real_telegram_window(self):
    # فیلتر کردن پنجره‌هایی که احتمالاً تلگرام هستند
    if ('telegram' in window_title and 
        'messenger' not in window_title and  # حذف برنامه Python
        'ai' not in window_title and        # حذف برنامه Python
        window.width > 300):                # حداقل اندازه
        telegram_windows.append(window)
```

### 2️⃣ **مشکل activate window**
**قبل**: خطای "Error code from Windows: 0"  
**حالا**: سه روش جایگزین برای فعال‌سازی

```python
def safe_activate_window(self, window):
    # روش 1: pygetwindow
    # روش 2: کلیک در وسط پنجره  
    # روش 3: Alt+Tab
```

### 3️⃣ **مشکل WindowsApps**
**قبل**: دسترسی مستقیم به فایل محافظت شده  
**حالا**: باز کردن از طریق Windows Store Protocol

```python
def open_telegram_with_path_safe(self, telegram_path):
    if "WindowsApps" in telegram_path:
        # استفاده از Windows Store Protocol
        os.system('start telegram://')
```

### 4️⃣ **تأیید اسکرین‌شات**
**جدید**: بررسی اینکه اسکرین‌شات از تلگرام است

```python
def verify_telegram_screenshot(self, screenshot):
    # تشخیص رنگ آبی مشخصه تلگرام
    # بررسی ساختار UI مشابه تلگرام
```

## 🚀 **نحوه استفاده:**

### **روش 1: خودکار (توصیه می‌شود)**
1. برنامه را اجرا کنید
2. روی دکمه "🐈 اسکرین Littlejoy + پاسخ" کلیک کنید  
3. برنامه خودکار تلگرام را پیدا می‌کند و fullscreen می‌کند

### **روش 2: دستی (در صورت مشکل)**
1. تلگرام را قبلاً باز کنید
2. F11 بزنید تا fullscreen شود
3. سپس برنامه را اجرا کنید

## 📊 **خروجی موفق:**

```
🔍 در حال تشخیص اکانت‌های تلگرام...
✅ 1 اکانت تلگرام پیدا شد
📱 در حال باز کردن تلگرام برای اکانت: اکانت اصلی...
✅ تلگرام (Windows Store) باز شد
🖼️ شروع اسکرین گرفتن از تلگرام: اکانت اصلی
🐈 فقط چت‌های فولدر Littlejoy🐈 پردازش می‌شوند
🔍 پنجره تلگرام پیدا شد: 'Telegram' - 1920x1080
✅ پنجره تلگرام واقعی پیدا شد: Telegram
✅ پنجره با pygetwindow فعال شد
📺 در حال تمام صفحه کردن تلگرام...
✅ پنجره maximize شد
✅ F11 فشرده شد برای fullscreen
📏 ابعاد صفحه: 1920x1080
✅ اسکرین‌شات تمام صفحه از تلگرام ذخیره شد!
✅ اسکرین‌شات از تلگرام تأیید شد (آبی: 15420, خطوط: 890)
🔍 شروع تشخیص چت‌ها از اسکرین‌شات تمام صفحه...
🎯 3 موقعیت چت تشخیص داده شد
🐈 3 چت Littlejoy تشخیص داده شد
💬 پردازش چت: نام_چت_littlejoy
✅ پاسخ ارسال شد: 🐈 سلام! Littlejoy چطوره؟...
✅ چت 1 با موفقیت پردازش شد
```

## 🛠️ **عیب‌یابی:**

### **اگر هنوز پنجره اشتباه تشخیص داده می‌شود:**
1. تلگرام را ببندید
2. برنامه Python را ببندید  
3. ابتدا تلگرام را باز کنید
4. سپس برنامه Python را اجرا کنید

### **اگر خطای activate ادامه دارد:**
```python
# روش دستی:
# 1. Alt+Tab بزنید
# 2. تلگرام را انتخاب کنید  
# 3. F11 بزنید
# 4. برنامه را اجرا کنید
```

### **اگر اسکرین‌شات اشتباه است:**
- برنامه خودکار تشخیص می‌دهد
- پیام "اسکرین‌شات احتمالاً از تلگرام نیست" نمایش می‌دهد
- خودکار تلاش مجدد می‌کند

## ✨ **تغییرات کلیدی:**

1. **فیلتر هوشمند پنجره**: ❌ "Telegram AI Messenger" ✅ "Telegram"
2. **فعال‌سازی ایمن**: سه روش جایگزین  
3. **WindowsApps Support**: Protocol-based opening
4. **Screenshot Verification**: تأیید محتوای تلگرام
5. **Error Recovery**: تلاش مجدد خودکار

**حالا برنامه کاملاً عملیاتی است!** 🎉🐈

## ⚡ نصب فوری (Quick Start)

### 1. نصب Python
```bash
# دانلود Python 3.8+ از python.org
# در ویندوز: "Add Python to PATH" را تیک بزنید
```

### 2. نصب Ollama
```bash
# دانلود از https://ollama.ai
# نصب در ویندوز یا لینوکس
```

### 3. نصب مدل AI
```bash
ollama pull llama3.1:8b
# یا
ollama pull llama3.2
```

### 4. دانلود پروژه
```bash
git clone https://github.com/Amsh23/telegram-ai-messenger.git
cd telegram-ai-messenger
```

### 5. نصب وابستگی‌ها
```bash
pip install -r requirements.txt
```

### 6. اجرا
```bash
python telegram_ai_messenger.py
```

---

## 🔧 پیکربندی اولیه

### مرحله 1: تنظیم اکانت‌ها
فایل `ai_config.json` را باز کنید و اکانت‌های خود را اضافه کنید:

```json
{
  "telegram_accounts": [
    {
      "username": "اکانت اصلی",
      "telegram_path": "مسیر تلگرام خود را اینجا وارد کنید"
    }
  ]
}
```

**پیدا کردن مسیر تلگرام:**
- **Windows Store**: `C:\Program Files\WindowsApps\TelegramMessengerLLP.TelegramDesktop_*\Telegram.exe`
- **دسکتاپ معمولی**: `C:\Users\[نام کاربری]\AppData\Roaming\Telegram Desktop\Telegram.exe`
- **نصب سفارشی**: مسیری که تلگرام را نصب کرده‌اید

### مرحله 2: تنظیم گروه‌ها
```json
{
  "groups": [
    {
      "group_name": "نام گروه",
      "chat_id": "Chat ID گروه (مثال: -1001234567890)"
    }
  ]
}
```

**پیدا کردن Chat ID:**
1. به ربات @userinfobot پیام دهید
2. ربات را به گروه اضافه کنید
3. دستور `/start` را ارسال کنید
4. Chat ID را کپی کنید

### مرحله 3: تست اتصال
1. برنامه را اجرا کنید
2. دکمه "🤖 تست AI" را بزنید
3. اگر موفق بود، آماده استفاده هستید!

---

## 🎯 استفاده ساده

### ارسال پیام هوشمند:
1. اکانت و گروه را انتخاب کنید
2. پیام پایه را وارد کنید
3. دکمه "🚀 شروع ارسال هوشمند" را بزنید

### خواندن و پاسخ خودکار:
1. تلگرام را باز کنید
2. لیست چت‌ها در سمت چپ باشد
3. دکمه "👁️ خواندن و پاسخ به همه چت‌ها" را بزنید

---

## ⚠️ نکات مهم

1. **تلگرام باز باشد**: برنامه نیاز به تلگرام باز دارد
2. **Ollama فعال باشد**: مطمئن شوید سرویس Ollama اجرا است
3. **دسترسی‌ها**: به برنامه اجازه کنترل صفحه‌کلید و ماوس بدهید
4. **صفحه‌نمایش**: تلگرام در حالت windowed اجرا کنید

---

## 🚨 عیب‌یابی سریع

### خطا: "AI پاسخ نمی‌دهد"
```bash
# بررسی Ollama
ollama list
ollama serve
```

### خطا: "گروه پیدا نمی‌شود"
- Chat ID را دوباره بررسی کنید
- مطمئن شوید عضو گروه هستید

### خطا: "تلگرام باز نمی‌شود"  
- مسیر تلگرام را در `ai_config.json` بررسی کنید
- تلگرام را دستی اجرا کنید

---

## 🎁 مثال آماده

نمونه کامل `ai_config.json`:

```json
{
  "telegram_accounts": [
    {
      "username": "اکانت من",
      "telegram_path": "C:\\Users\\User\\AppData\\Roaming\\Telegram Desktop\\Telegram.exe"
    }
  ],
  "groups": [
    {
      "group_name": "گروه تست",
      "chat_id": "-1001234567890"
    }
  ],
  "base_message": "سلام دوستان! چطورید؟",
  "interval_seconds": 60,
  "ollama_url": "http://127.0.0.1:11434",
  "ollama_model": "llama3.1:8b",
  "ai_enabled": true,
  "personality": "دوستانه و صمیمی",
  "message_variety": true,
  "use_emojis": true
}
```

---

## ✅ چک‌لیست آماده‌سازی

- [ ] Python نصب شده
- [ ] Ollama نصب و اجرا شده  
- [ ] مدل AI دانلود شده
- [ ] وابستگی‌ها نصب شده
- [ ] `ai_config.json` تنظیم شده
- [ ] تلگرام باز و قابل دسترس
- [ ] تست AI موفق بوده

## 🎉 آماده استفاده!

اگر همه مراحل را طی کردید، برنامه آماده استفاده است. موفق باشید! 🚀
